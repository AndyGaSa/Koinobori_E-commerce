/* --- RANDOM QUESTIONS ARRAYS --- */
//Variables with random questions
var questionsRandom1 = [
    { a: "CON LA A. Dicho de una supuesta criatura extraterrestre: Apoderarse de alguien." },
    { b: "CON LA B. Juego que ha sacado de quicio a todos los 'Skylabers' en las sesiones de precurso." },
    { c: "CON LA C. Niño, crío, bebé." },
    { d: "CON LA D. Anormalidad en la función del aparato digestivo caracterizada por frecuentes evacuaciones y su consistencia líquida." },
    { e: "CON LA E. Gelatinoso y se encuentra debajo de la membrana plasmática. Los cazafantasmas medían su radiación." },
    { f: "CON LA F. Que no requiere gran esfuerzo, capacidad o dificultad." },
    { g: "CON LA G. Conjunto enorme de estrellas, polvo interestelar, gases y partículas." },
    { h: "CON LA H. Suicidio ritual japonés por desentrañamiento." },
    { i: "CON LA I. Templo cristiano." },
    { j: "CON LA J. Variedad salvaje del cerdo que sale en la película 'El Rey León', de nombre Pumba." },
    { k: "CON LA K. Persona que se juega la vida realizando una acción temeraria." },
    { l: "CON LA L. Hombre lobo." },
    { m: "CON LA M. Persona que huye del trato con otras personas o siente gran aversión hacia ellas." },
    { n: "CON LA N. Demostración de poca inteligencia." },
    { ñ: "CONTIENE LA Ñ. Indicio que permite deducir algo de lo que no se tiene un conocimiento directo." },
    { o: "CON LA O. Humanoide fantástico de apariencia terrible y bestial, piel de color verde creada por el escritor Tolkien." },
    { p: "CON LA P. Raza ancestral tecnológicamente avanzada que se caracteriza por sus grandes poderes psíonicos del videojuego StarCraft." },
    { q: "CON LA Q. Producto obtenido por la maduración de la cuajada de la leche" },
    { r: "CON LA R. Roedor." },
    { s: "CON LA S. Comunidad salvadora de todo desarrollador informático." },
    { t: "CON LA T. Película del director James Cameron que consolidó a Arnold Schwarzenegger como actor en 1984." },
    { u: "CON LA U. Escritor y filósofo español de la generación del 98 autor del libro 'Niebla' en 1914." },
    { v: "CON LA V. Nombre dado a los miembros de los pueblos nórdicos originarios de Escandinavia, famosos por sus incursiones y pillajes en Europa." },
    { w: "CONTIENE LA W. Emparedado hecho con dos rebanadas de pan entre las cuales se coloca jamón y queso." },
    { x: "CONTIENE LA X. Toxina bacteriana utilizada en cirujía estética." },
    { y: "CONTIENE LA Y. Pequeño cáctus conocido por sus alcaloides psicoactivos utilizado de forma ritual y medicinal por indígenas americanos." },
    { z: "CON LA Z. Escuela de budismo que busca la experiencia de la sabiduría más allá del discurso racional." }
];
var questionsRandom2 = [
    { a: "CON LA A. Alejar un miembro o una región del cuerpo del plano medio que divide imaginariamente el organismo en dos partes simétricas." },
    { b: "CON LA B. Juego de azar semejante a la lotería en el que cada jugador debe completar los números de su cartón según van saliendo en el sorteo, y en el que gana el que antes completa todos." },
    { c: "CON LA C. Niño, muchacho." },
    { d: "CON LA D. Síntoma o fenómeno morboso que consiste en evacuaciones de vientre líquidas y frecuentes." },
    { e: "CON LA E. Emanación visible del cuerpo del médium." },
    { f: "CON LA F. Dicho de un suceso: Bastante probable." },
    { g: "CON LA G. Agrupación de estrellas, cuerpos celestes y materia cósmica que está concentrada en una determinada región del espacio por efecto de la atracción gravitatoria y constituye una unidad en el universo." },
    { h: "CON LA H. Forma de suicidio ritual, practicado en el Japón por razones de honor o por orden superior, consistente en abrirse el vientre." },
    { i: "CON LA I. Congregación de los fieles cristianos en virtud del bautismo." },
    { j: "CON LA J. Mamífero paquidermo de la familia del cerdo, de unos 110 a 150 cm de longitud, pelaje tupido y fuerte de color marrón o gris, cuello robusto, orejas tiesas, cabeza y hocico agudos, y dos colmillos curvos que le sobresalen de la boca." },
    { k: "CON LA K. En la Segunda Guerra Mundial, piloto suicida japonés que tripulaba un avión con explosivos con el que se lanzaba contra un objetivo." },
    { l: "CON LA L. Persona que, según la tradición popular, se convierte en lobo las noches de plenilunio." },
    { m: "CON LA M. Humano que siente aversión al trato con personas." },
    { n: "CON LA N. Dicho o hecho necio." },
    { ñ: "CONTIENE LA Ñ. Signo o medio que se emplea para luego acordarse de algo." },
    { o: "CON LA O. Una de las razas clásicas de el videojuego World of Warcraft." },
    { p: "CON LA P. Una de las tres razas del videojuego StarCraft, junto con los Zerg y los Terran." },
    { q: "CON LA Q. Producto obtenido por maduración de la cuajada de la leche con características propias para cada uno de los tipos según su origen o método de fabricación." },
    { r: "CON LA R. Mamífero roedor de pequeño tamaño, de hocico puntiagudo y cola larga, de pelaje corto." },
    { s: "CON LA S. Sitio que contiene preguntas y respuestas sobre una amplia gama de temas de programación." },
    { t: "CON LA T. Película que consolidó a Arnold Schwarzenegger como actor en 1984." },
    { u: "CON LA U. Escritor y filósofo español perteneciente a la generación del 98." },
    { v: "CON LA V. Dicho de una persona: De los pueblos navegantes escandinavos que entre los siglos VIII y XI realizaron incursiones por las islas del Atlántico y por casi toda la Europa occidental." },
    { w: "CONTIENE LA W. Especie de bocadillo hecho con dos o más rebanadas de pan de molde entre las que se pone algún tipo de alimento; se puede tomar frío o caliente." },
    { x: "CONTIENE LA X. Sustancia tóxica que produce parálisis muscular y que se utiliza con fines médicos y estéticos." },
    { y: "CONTIENE LA Y. Planta cactácea no espinosa, de pequeño tamaño y cubierta de pelos sedosos que contiene mescalina, alcaloide que produce efectos narcóticos." },
    { z: "CON LA Z. Escuela budista que tiende a alcanzar la iluminación espiritual mediante la meditación que no se somete al conocimiento intelectual y a sus conceptos." }
];
var questionsRandom3 = [
    { a: "CON LA A. Dicho de una persona o de una creación humana: Suscitar en alguien una poderosa atracción." },
    { b: "CON LA B. Indica que se ha solucionado o acertado algo." },
    { c: "CON LA C. Forma coloquial de llamar a un niño, muchacho." },
    { d: "CON LA D. Deposición, tres o más veces al día (o con una frecuencia mayor que la normal para la persona) de heces sueltas o líquidas." },
    { e: "CON LA E. Parte externa del citoplasma de algunas células de aspecto más fluido; es evidente en los protozoos." },
    { f: "CON LA F. Que se adapta con flexibilidad a las circunstancias." },
    { g: "CON LA G. Conjunto amplio de cosas, hechos, conceptos, etc., de características parecidas." },
    { h: "CON LA H. Suicidio ritual de origen japonés que se realiza por razones de honor y consiste en abrirse el vientre con un arma blanca." },
    { i: "CON LA I. Gobierno eclesiástico general del sumo pontífice, concilios y prelados." },
    { j: "CON LA J. Mamífero artiodáctilo, cuya variedad doméstica es el cerdo, de gran fortaleza, pelaje muy tupido gris o pardo y grandes colmillos salientes de la boca, que habita en bosques y matorrales." },
    { k: "CON LA K. Persona que lleva a cabo un atentado suicida." },
    { l: "CON LA L. Criatura legendaria presente en muchas culturas independientes a lo largo del mundo." },
    { m: "CON LA M. Dicho de una persona: Que siente o manifiesta misantropía." },
    { n: "CON LA N. Cualidad de necio." },
    { ñ: "CONTIENE LA Ñ. Rasgo o nota que se pone o hay en las cosas para darlas a conocer y distinguirlas de otras." },
    { o: "CON LA O. Raza fantástica de criaturas usadas como soldados y secuaces por los grandes villanos en las obras de Tolkien." },
    { p: "CON LA P. Una de las tres razas del videojuego StarCraft, junto con los Zerg y los Terran." },
    { q: "CON LA Q. Alimento sólido que se obtiene por maduración de la cuajada de la leche una vez eliminado el suero." },
    { r: "CON LA R. Pequeño aparato manual conectado a una computadora u otro dispositivo electrónico, cuya función es mover el cursor en la pantalla para dar órdenes." },
    { s: "CON LA S. Sitio de preguntas y respuestas para programadores profesionales y aficionados." },
    { t: "CON LA T. Película del director James Cameron que consolidó a un conocido actor en 1984." },
    { u: "CON LA U. Escritor y filósofo español perteneciente a la generación del 98." },
    { v: "CON LA V. Dicho de una persona que pertenecía a un pueblo de guerreros y navegantes que se extendió por las costas atlánticas y por Europa occidental entre los siglos VII y XI." },
    { w: "CONTIENE LA W. Bocadillo caliente de pan de molde, jamón cocido y queso." },
    { x: "CONTIENE LA X. Neurotoxina elaborada por una bacteria denominada Clostridium botulinum." },
    { y: "CONTIENE LA Y. Planta cactácea, de pequeño tamaño, que contiene una sustancia cuya ingestión produce efectos alucinógenos y narcóticos." },
    { z: "CON LA Z. Sistema filosófico budista que tuvo su origen en China en el siglo VI." }
];
//Variable with an array of the three random questions variables
var questionsRandomArr = [questionsRandom1, questionsRandom2, questionsRandom3];
//Functions that shuffle an array
function shuffle(questionsRandomArr) {
    var i = questionsRandomArr.length,
        j = 0,
        temp;
    while (i--) {
        j = Math.floor(Math.random() * (i + 1));
        temp = questionsRandomArr[i];
        questionsRandomArr[i] = questionsRandomArr[j];
        questionsRandomArr[j] = temp;
    }
    return questionsRandomArr;
}
//Variable with a random question variable
let ranQuestions = shuffle(questionsRandomArr);
//Main array with all the objects. Each object is a letter of the alphabet. We start at "status" 2.
var questionsArr = [

    { letter: "a", answer: "abducir", status: 2, question: questionsRandomArr[0][0].a },

    { letter: "b", answer: "bingo", status: 2, question: questionsRandomArr[0][1].b },

    { letter: "c", answer: "churumbel", status: 2, question: questionsRandomArr[0][2].c },

    { letter: "d", answer: "diarrea", status: 2, question: questionsRandomArr[0][3].d },

    { letter: "e", answer: "ectoplasma", status: 2, question: questionsRandomArr[0][4].e },

    { letter: "f", answer: "facil", status: 2, question: questionsRandomArr[0][5].f },

    { letter: "g", answer: "galaxia", status: 2, question: questionsRandomArr[0][6].g },

    { letter: "h", answer: "harakiri", status: 2, question: questionsRandomArr[0][7].h },

    { letter: "i", answer: "iglesia", status: 2, question: questionsRandomArr[0][8].i },

    { letter: "j", answer: "jabali", status: 2, question: questionsRandomArr[0][9].j },

    { letter: "k", answer: "kamikaze", status: 2, question: questionsRandomArr[0][10].k },

    { letter: "l", answer: "licantropo", status: 2, question: questionsRandomArr[0][11].l },

    { letter: "m", answer: "misantropo", status: 2, question: questionsRandomArr[0][12].m },

    { letter: "n", answer: "necedad", status: 2, question: questionsRandomArr[0][13].n },

    { letter: "ñ", answer: "señal", status: 2, question: questionsRandomArr[0][14].ñ },

    { letter: "o", answer: "orco", status: 2, question: questionsRandomArr[0][15].o },

    { letter: "p", answer: "protoss", status: 2, question: questionsRandomArr[0][16].p },

    { letter: "q", answer: "queso", status: 2, question: questionsRandomArr[0][17].q },

    { letter: "r", answer: "raton", status: 2, question: questionsRandomArr[0][18].r },

    { letter: "s", answer: "stackoverflow", status: 2, question: questionsRandomArr[0][19].s },

    { letter: "t", answer: "terminator", status: 2, question: questionsRandomArr[0][20].t },

    { letter: "u", answer: "unamuno", status: 2, question: questionsRandomArr[0][21].u },

    { letter: "v", answer: "vikingos", status: 2, question: questionsRandomArr[0][22].v },

    { letter: "w", answer: "sandwich", status: 2, question: questionsRandomArr[0][23].w },

    { letter: "x", answer: "botox", status: 2, question: questionsRandomArr[0][24].x },

    { letter: "y", answer: "peyote", status: 2, question: questionsRandomArr[0][25].y },

    { letter: "z", answer: "zen", status: 2, question: questionsRandomArr[0][26].z }];

//All buttons hidden at start
document.getElementById('next-button').hidden = true;
document.getElementById('image-check').hidden = true;
document.getElementById('image-delete').hidden = true;
document.getElementById('image-over').hidden = true;
document.getElementById('image-gratz').hidden = true;
document.getElementById('re-game-button').hidden = true;

//Variables for right answers and failured answers
let rightAnswers = 0;
let failuredAnswers = 0;
document.getElementById('right-answer').innerHTML = rightAnswers;
document.getElementById('failed-answer').innerHTML = failuredAnswers;

/* --- RANKING --- */
//Variable for ranking
let rank = [
    { nombre: 'Francesc', puntuacion: 17 },
    { nombre: 'Maki', puntuacion: 25 },
    { nombre: 'Serafín', puntuacion: 21 }
];
let sortedRank = rank.sort((a, b) => (b.puntuacion) - (a.puntuacion));
document.getElementById('ranking-name1').innerHTML = rank[0].nombre;
document.getElementById('ranking-puntuation1').innerHTML = rank[0].puntuacion;
document.getElementById('ranking-name2').innerHTML = rank[1].nombre;
document.getElementById('ranking-puntuation2').innerHTML = rank[1].puntuacion;
document.getElementById('ranking-name3').innerHTML = rank[2].nombre;
document.getElementById('ranking-puntuation3').innerHTML = rank[2].puntuacion;

// Variable to get username from user
let userName;

//Start button is disabled until user writes its name
document.getElementById('start-button').disabled = true;
function keyUsername(event) {
    document.getElementById('start-button').disabled = false;
}
document.getElementById('usernickname').onkeyup = keyUsername;

/* --- START FUNCTION --- */
/*Start function. Get the value once the user has written and clicked the button "start".
It also shuffle the questions so each time we play, we have different questions. The game start at index 0 and letter 0*/
function start() {
    userName = document.getElementById('usernickname').value;
    if (userName === '') {
        userName = 'Anónimo';
    }
    ranQuestions = shuffle(questionsRandomArr);
    pasapalabraGame(0, questionsArr[0].letter);
}

document.getElementById('start-button').onclick = start;

//Variable to push each letter waiting at "pasapalabra" mood
let pasapalabraWordsWaiting = [];

/* --- MAIN GAME FUNCTION --- */
/*Main function where 
i = index of the letter we are playing with
j = letter property of the letter we are playing with
That's why we start at pasapalabraGame(0, questionsArr[0].letter),
is index 0 letter 'a'. In CSS we have an id for each letter.
*/
function pasapalabraGame(i, j) {

    let rightAnswerInterval;

    /* --- TIMER --- */
    //Set an interval as a countdown from 120 to 0 seconds. If we end the game, the interval stops and everything is disabled
    let countdownTimer = setInterval(timer, 1000);
    let seconds = document.getElementById('countdown').textContent;
    function timer() {
        seconds--;
        document.getElementById('countdown').textContent = seconds;
        if (seconds <= 0) {
            stopTimer();
            document.getElementById('image-over').hidden = false;
            document.getElementById('next-button').hidden = true;
            document.getElementById('image-gratz').hidden = true;
            document.getElementById('re-game-button').hidden = false;
            document.getElementById('display').innerHTML = `¡Se acabó el tiempo!<br><br>Inténtalo de nuevo a la próxima<br><br>¡Gracias por jugar!`;
            document.getElementById('answer').disabled = true;
            document.getElementById('pasapalabra-button').disabled = true;
            let user = { nombre: userName, puntuacion: rightAnswers };
            rank.push(user);
        } else if (questionsArr.every((elem) => elem.status === 0)) {
            stopTimer();
        }
    }
    function stopTimer() {
        clearInterval(countdownTimer);
    }

    //Set the question on the display HTML and turns the background in orange so the user
    //can see that we are playing with that letter
    document.getElementById('display').style.fontSize = '16px';
    document.getElementById('display').innerHTML = questionsArr[i].question;
    document.getElementById(j).style.backgroundColor = '#ec9b32';
    document.getElementById(j).style.borderColor = '#ba7822';
    document.getElementById('image-check').hidden = true;
    document.getElementById('image-delete').hidden = true;
    document.getElementById('image-over').hidden = true;
    document.getElementById('image-gratz').hidden = true;
    document.getElementById('next-button').hidden = true;
    document.getElementById('re-game-button').hidden = true;

    //User writes its answer on the input "answer". If it press Enter, this functions
    //saves the value and call the check function
    function keyEnter(event) {
        if (event.code === 'Enter') {
            userAnswer = document.getElementById('answer').value;
            userAnswer = userAnswer.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            check();
        }
    }
    document.getElementById('answer').onkeyup = keyEnter;

    //If user click on "pasapalabra button", change the status of the letter to 1 and pushes
    //the letter to pasapalabraWordsWaiting array for later. Background turns blue again
    function pasapalabraFunction() {
        stopInterval();
        questionsArr[i].status = 1;
        pasapalabraWordsWaiting.push(i);
        document.getElementById(j).style.backgroundColor = '#0094ff';
        document.getElementById(j).style.borderColor = '#0080db';
        document.getElementById('display').style.fontSize = '22px';
        document.getElementById('display').innerHTML = `<br><br>¡Has pasado palabra!`;
        rightAnswerInterval = setInterval(nextButtonFunc, 1000);
    }
    document.getElementById('pasapalabra-button').onclick = pasapalabraFunction;

    //If there is an answer, we quit spaces, and turn it to lower case
    function check() {
        if (userAnswer !== '') {
            userAnswer = userAnswer.trim();
            userAnswer = userAnswer.toLowerCase();
            //If answer is right, status change to 0, rightAnswers increase its value and background turns green
            if (userAnswer === questionsArr[i].answer) {
                questionsArr[i].status = 0;
                rightAnswers++;
                document.getElementById('right-answer').innerHTML = rightAnswers;
                document.getElementById('display').innerHTML = `¡Correcto!<br><br>¡Tienes un nuevo punto!`;
                document.getElementById('image-check').hidden = false;
                document.getElementById(j).style.backgroundColor = '#1fe65b';
                document.getElementById(j).style.borderColor = '#0aca44';
                rightAnswerInterval = setInterval(nextButtonFunc, 1000);
                //If answer is failured, status change to 0, failuredAnswers increase its value and background turns red
            } else if (userAnswer !== questionsArr[i].answer) {
                questionsArr[i].status = 0;
                failuredAnswers++;
                document.getElementById('failed-answer').innerHTML = failuredAnswers;
                document.getElementById('display').innerHTML = `¡Oh no, has fallado. La respuesta correcta era ${questionsArr[i].answer}!`;
                document.getElementById('image-delete').hidden = false;
                document.getElementById('next-button').hidden = false;
                document.getElementById(j).style.backgroundColor = '#f94a4a';
                document.getElementById(j).style.borderColor = '#ff0000';
            }
        } else {
            document.getElementById('display').style.fontSize = '16px';
            document.getElementById('display').innerHTML = questionsArr[i].question;
        }
    }

    //Function to clear interval so the buttons won't crazy
    function stopInterval() {
        clearInterval(rightAnswerInterval);
    }

    //User click on "next" button 
    function nextButtonFunc() {
        stopInterval();
        document.getElementById('answer').value = '';
        //If user already has turned the donut of our game, all the elements should be different to number 2, so the game
        //calls to testOut function
        if (questionsArr.every((elem) => elem.status !== 2)) {
            testOut();
            //If not, the game just go for the next letter
        } else {
            pasapalabraGame(i + 1, questionsArr[i + 1].letter);
        }
    }
    document.getElementById('next-button').onclick = nextButtonFunc;

    //This functions test whether all letters are on status 0 or if there is one remaining 1
    function testOut() {
        //If there are letters with status 1, there are "pasapalabra" words waiting. Call the pasapalabraWaiting function
        if (questionsArr.some((elem) => elem.status === 1)) {
            pasapalabraWaiting();
            //If all letters are at status 0, timer stops, game push user to the ranking and everything is disabled
        } else if (questionsArr.every((elem) => elem.status === 0)) {
            let user = { nombre: userName, puntuacion: rightAnswers };
            rank.push(user);
            document.getElementById('display').innerHTML = `Has completado el rosco. Si quieres ver tu posición en el ranking, consúltala debajo.<br><br> 
            Ten en cuenta que solo se muestra el Top 3<br><br>`;
            document.getElementById('answer').disabled = true;
            document.getElementById('pasapalabra-button').disabled = true;
            stopTimer();
            sortedRank = rank.sort((a, b) => (b.puntuacion) - (a.puntuacion));
            document.getElementById('ranking-name1').innerHTML = sortedRank[0].nombre;
            document.getElementById('ranking-puntuation1').innerHTML = sortedRank[0].puntuacion;
            document.getElementById('ranking-name2').innerHTML = sortedRank[1].nombre;
            document.getElementById('ranking-puntuation2').innerHTML = sortedRank[1].puntuacion;
            document.getElementById('ranking-name3').innerHTML = sortedRank[2].nombre;
            document.getElementById('ranking-puntuation3').innerHTML = sortedRank[2].puntuacion;
            document.getElementById('image-check').hidden = true;
            document.getElementById('image-delete').hidden = true;
            document.getElementById('next-button').hidden = true;
            document.getElementById('image-over').hidden = true;
            document.getElementById('image-gratz').hidden = false;
            document.getElementById('re-game-button').hidden = false;
        }
    }

    /*Just like in the pasapalabraGame function
    i = content of the pasapalabraWordsWaiting variable
    j = letter of the index of that content in the main questionsArr variable
    call again pasapalabraGame with those new arguments
    */
    function pasapalabraWaiting() {
        i = pasapalabraWordsWaiting[0];
        j = questionsArr[i].letter;
        pasapalabraWordsWaiting.shift();
        pasapalabraGame(i, j);
    }

    //Refresh the page to play again
    function playAgain() {
        location.reload();
    }
    document.getElementById('re-game-button').onclick = playAgain;

    //If user click on exit button, timer stops and everything is disabled
    function exit() {
        document.getElementById('answer').value = '';
        document.getElementById('display').innerHTML = `¡Hasta la próxima!<br><br> No entras en el ranking ya que has abandonado antes de tiempo`;
        document.getElementById('answer').disabled = true;
        document.getElementById('pasapalabra-button').disabled = true;
        stopTimer();
        document.getElementById('image-check').hidden = true;
        document.getElementById('image-delete').hidden = true;
        document.getElementById('next-button').hidden = true;
        document.getElementById('image-over').hidden = true;
        document.getElementById('image-gratz').hidden = false;
        document.getElementById('re-game-button').hidden = false;
    }
    document.getElementById('exit-button').onclick = exit;
}